<!DOCTYPE html>
<html lang="en" dir="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Azure Application Gateway ‚Äì Backend Health Unknown?  | KasdevTech</title>
<meta name="keywords" content="Azure Application Gateway, Troubleshooting, Probes, NSG, Load Balancer">
<meta name="description" content="App Gateway backend shows &#39;Unknown&#39; or &#39;Unhealthy&#39;? Follow this detailed troubleshooting guide to fix it.">
<meta name="author" content="Kasi Suresh">
<link rel="canonical" href="http://localhost:1313/azure/appgw_issues/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.8fe10233a706bc87f2e08b3cf97b8bd4c0a80f10675a143675d59212121037c0.css" integrity="sha256-j&#43;ECM6cGvIfy4Is8&#43;XuL1MCoDxBnWhQ2ddWSEhIQN8A=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/images/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="http://localhost:1313/azure/appgw_issues/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:url" content="http://localhost:1313/azure/appgw_issues/">
  <meta property="og:site_name" content="KasdevTech">
  <meta property="og:title" content="Azure Application Gateway ‚Äì Backend Health Unknown? ">
  <meta property="og:description" content="App Gateway backend shows &#39;Unknown&#39; or &#39;Unhealthy&#39;? Follow this detailed troubleshooting guide to fix it.">
  <meta property="og:locale" content="en-us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="azure">
    <meta property="article:published_time" content="2025-08-03T00:00:00+00:00">
    <meta property="article:modified_time" content="2025-08-03T00:00:00+00:00">
    <meta property="article:tag" content="Azure Application Gateway">
    <meta property="article:tag" content="Troubleshooting">
    <meta property="article:tag" content="Probes">
    <meta property="article:tag" content="NSG">
    <meta property="article:tag" content="Load Balancer">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Azure Application Gateway ‚Äì Backend Health Unknown? ">
<meta name="twitter:description" content="App Gateway backend shows &#39;Unknown&#39; or &#39;Unhealthy&#39;? Follow this detailed troubleshooting guide to fix it.">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Azure",
      "item": "http://localhost:1313/azure/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Azure Application Gateway ‚Äì Backend Health Unknown? ",
      "item": "http://localhost:1313/azure/appgw_issues/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Azure Application Gateway ‚Äì Backend Health Unknown? ",
  "name": "Azure Application Gateway ‚Äì Backend Health Unknown? ",
  "description": "App Gateway backend shows 'Unknown' or 'Unhealthy'? Follow this detailed troubleshooting guide to fix it.",
  "keywords": [
    "Azure Application Gateway", "Troubleshooting", "Probes", "NSG", "Load Balancer"
  ],
  "articleBody": "Azure Application Gateway ‚Äì Backend Health Unknown? If you‚Äôre using Azure Application Gateway and you see:\nBackend health: UNKNOWN\nBackend health: UNHEALTHY\nDon‚Äôt panic. This is a common issue ‚Äî and we‚Äôll walk through how to fix it end-to-end, even if you‚Äôre new to Azure.\nWhat Does ‚ÄúUnknown‚Äù or ‚ÄúUnhealthy‚Äù Mean? Unknown = App Gateway can‚Äôt reach the backend (network issue) Unhealthy = App Gateway can reach the backend, but probe failed (wrong path, port, etc.) Step-by-Step Troubleshooting Step 1: Check Backend Pool IP/VM Go to: App Gateway ‚Üí Backend pools Confirm:\nCorrect IP or FQDN The backend (VM, App, etc.) is running If using FQDN, DNS must be resolvable Step 2: Validate Probes App Gateway ‚Üí Health Probes\nConfirm the path exists ‚Äî e.g., /health, /status, etc. Check protocol (HTTP or HTTPS) Ensure custom host name (if used) matches backend cert (for HTTPS) Avoid using / as probe path for apps that require login or redirect.\nStep 3: Review Listener + HTTP Settings App Gateway ‚Üí HTTP Settings\nBackend port = matches backend (usually 80 or 443) Use correct protocol If HTTPS: Set pick host name from backend, or set manually Associate with correct probe Step 4: Backend NSG and Routes Check backend subnet‚Äôs NSG:\nAllow:\nInbound from App Gateway subnet on port 80/443 Outbound to App Gateway if response is needed Check UDR (User Defined Routes):\nAvoid sending App Gateway traffic to NVA/firewall unless configured properly.\nStep 5: Diagnose from App Gateway Go to:\nApp Gateway ‚Üí Backend health\nHere you‚Äôll see:\nBackend Status Code Description 10.0.1.4 Unknown 0 No response 10.0.1.5 Unhealthy 403 Probe failed auth Click each backend to view probe logs and exact error\nStep 6: Use Network Watcher Enable Connection Troubleshoot from:\nNetwork Watcher ‚Üí Connection troubleshoot\nTest from App Gateway subnet ‚Üí Backend IP:Port Verify reachability and response time Fix Summary Issue Fix Backend health Unknown NSG/UDR block, wrong IP, DNS issue Backend health Unhealthy Wrong probe path, wrong port/cert HTTPS failing probe Hostname mismatch or cert issue DNS FQDN backend unreachable Private DNS or no resolution VMs in stopped state Start them or replace in backend pool Quick Fix ‚Äì Sample NSG Rule az network nsg rule create \\ --resource-group myRG \\ --nsg-name backend-nsg \\ --name AllowAppGw \\ --priority 100 \\ --direction Inbound \\ --access Allow \\ --protocol Tcp \\ --source-address-prefixes \\ --destination-port-ranges 80 443 Final Tips: Use custom probes over default probes Always test probe path manually in browser or Postman For HTTPS, check backend certs and hostname validation Use FQDN only if DNS is guaranteed to resolve\nReferences: Troubleshoot App Gateway backend health Custom probes\nNeed help debugging your Gateway? Drop a comment or reach out on LinkedIn!\n‚Äì Kasi @ KasdevTech üöÄ\n",
  "wordCount" : "454",
  "inLanguage": "en",
  "datePublished": "2025-08-03T00:00:00Z",
  "dateModified": "2025-08-03T00:00:00Z",
  "author":{
    "@type": "Person",
    "name": "Kasi Suresh"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http://localhost:1313/azure/appgw_issues/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "KasdevTech",
    "logo": {
      "@type": "ImageObject",
      "url": "http://localhost:1313/images/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="KasdevTech (Alt + H)">KasdevTech</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/azure/" title="Azure">
                    <span>Azure</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/devops/" title="DevOps">
                    <span>DevOps</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/finops/" title="FinOps">
                    <span>FinOps</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/terraform/" title="Terraform">
                    <span>Terraform</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/ai/" title="AI">
                    <span>AI</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/finsight/" title="Finsight">
                    <span>Finsight</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/about/" title="About">
                    <span>About</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      Azure Application Gateway ‚Äì Backend Health Unknown? 
    </h1>
    <div class="post-description">
      App Gateway backend shows &#39;Unknown&#39; or &#39;Unhealthy&#39;? Follow this detailed troubleshooting guide to fix it.
    </div>
    <div class="post-meta"><span title='2025-08-03 00:00:00 +0000 UTC'>August 3, 2025</span>&nbsp;¬∑&nbsp;3 min&nbsp;¬∑&nbsp;Kasi Suresh

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#azure-application-gateway--backend-health-unknown" aria-label="Azure Application Gateway ‚Äì Backend Health Unknown?">Azure Application Gateway ‚Äì Backend Health Unknown?</a><ul>
                        
                <li>
                    <a href="#what-does-unknown-or-unhealthy-mean" aria-label="What Does ‚ÄúUnknown‚Äù or ‚ÄúUnhealthy‚Äù Mean?">What Does ‚ÄúUnknown‚Äù or ‚ÄúUnhealthy‚Äù Mean?</a></li>
                <li>
                    <a href="#step-by-step-troubleshooting" aria-label="Step-by-Step Troubleshooting">Step-by-Step Troubleshooting</a></li>
                <li>
                    <a href="#step-1-check-backend-pool-ipvm" aria-label="Step 1: Check Backend Pool IP/VM">Step 1: Check Backend Pool IP/VM</a></li>
                <li>
                    <a href="#step-2-validate-probes" aria-label="Step 2: Validate Probes">Step 2: Validate Probes</a></li>
                <li>
                    <a href="#step-3-review-listener--http-settings" aria-label="Step 3: Review Listener &#43; HTTP Settings">Step 3: Review Listener + HTTP Settings</a></li>
                <li>
                    <a href="#step-4-backend-nsg-and-routes" aria-label="Step 4: Backend NSG and Routes">Step 4: Backend NSG and Routes</a></li>
                <li>
                    <a href="#step-5-diagnose-from-app-gateway" aria-label="Step 5: Diagnose from App Gateway">Step 5: Diagnose from App Gateway</a></li>
                <li>
                    <a href="#step-6-use-network-watcher" aria-label="Step 6: Use Network Watcher">Step 6: Use Network Watcher</a></li>
                <li>
                    <a href="#fix-summary" aria-label="Fix Summary">Fix Summary</a></li>
                <li>
                    <a href="#quick-fix--sample-nsg-rule" aria-label="Quick Fix ‚Äì Sample NSG Rule">Quick Fix ‚Äì Sample NSG Rule</a>
                </li>
            </ul>
            </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h3 id="azure-application-gateway--backend-health-unknown">Azure Application Gateway ‚Äì Backend Health Unknown?<a hidden class="anchor" aria-hidden="true" href="#azure-application-gateway--backend-health-unknown">#</a></h3>
<p>If you‚Äôre using Azure Application Gateway and you see:</p>
<blockquote>
<p><strong>Backend health: UNKNOWN</strong><br>
<strong>Backend health: UNHEALTHY</strong></p></blockquote>
<p>Don‚Äôt panic. This is a common issue ‚Äî and we‚Äôll walk through how to fix it <strong>end-to-end</strong>, even if you‚Äôre new to Azure.</p>
<h4 id="what-does-unknown-or-unhealthy-mean">What Does ‚ÄúUnknown‚Äù or ‚ÄúUnhealthy‚Äù Mean?<a hidden class="anchor" aria-hidden="true" href="#what-does-unknown-or-unhealthy-mean">#</a></h4>
<ul>
<li><strong>Unknown</strong> = App Gateway <strong>can‚Äôt reach</strong> the backend (network issue)</li>
<li><strong>Unhealthy</strong> = App Gateway <strong>can reach</strong> the backend, but <strong>probe failed</strong> (wrong path, port, etc.)</li>
</ul>
<h4 id="step-by-step-troubleshooting">Step-by-Step Troubleshooting<a hidden class="anchor" aria-hidden="true" href="#step-by-step-troubleshooting">#</a></h4>
<h4 id="step-1-check-backend-pool-ipvm">Step 1: Check Backend Pool IP/VM<a hidden class="anchor" aria-hidden="true" href="#step-1-check-backend-pool-ipvm">#</a></h4>
<p>Go to:
App Gateway ‚Üí <strong>Backend pools</strong>
Confirm:</p>
<ul>
<li>Correct <strong>IP or FQDN</strong></li>
<li>The backend (VM, App, etc.) is <strong>running</strong></li>
<li>If using <strong>FQDN</strong>, DNS must be resolvable</li>
</ul>
<h4 id="step-2-validate-probes">Step 2: Validate Probes<a hidden class="anchor" aria-hidden="true" href="#step-2-validate-probes">#</a></h4>
<p>App Gateway ‚Üí <strong>Health Probes</strong></p>
<ul>
<li>Confirm the <strong>path</strong> exists ‚Äî e.g., <code>/health</code>, <code>/status</code>, etc.</li>
<li>Check <strong>protocol</strong> (HTTP or HTTPS)</li>
<li>Ensure <strong>custom host name</strong> (if used) matches backend cert (for HTTPS)</li>
</ul>
<p>Avoid using <code>/</code> as probe path for apps that require login or redirect.</p>
<h4 id="step-3-review-listener--http-settings">Step 3: Review Listener + HTTP Settings<a hidden class="anchor" aria-hidden="true" href="#step-3-review-listener--http-settings">#</a></h4>
<p>App Gateway ‚Üí <strong>HTTP Settings</strong></p>
<ul>
<li>Backend port = matches backend (usually 80 or 443)</li>
<li>Use correct <strong>protocol</strong></li>
<li>If HTTPS: Set <strong>pick host name from backend</strong>, or set manually</li>
<li>Associate with correct <strong>probe</strong></li>
</ul>
<h4 id="step-4-backend-nsg-and-routes">Step 4: Backend NSG and Routes<a hidden class="anchor" aria-hidden="true" href="#step-4-backend-nsg-and-routes">#</a></h4>
<p>Check <strong>backend subnet‚Äôs NSG</strong>:</p>
<p>Allow:</p>
<ul>
<li>Inbound from App Gateway subnet on <strong>port 80/443</strong></li>
<li>Outbound to App Gateway if response is needed</li>
</ul>
<p>Check <strong>UDR</strong> (User Defined Routes):</p>
<p>Avoid sending App Gateway traffic to NVA/firewall unless configured properly.</p>
<h4 id="step-5-diagnose-from-app-gateway">Step 5: Diagnose from App Gateway<a hidden class="anchor" aria-hidden="true" href="#step-5-diagnose-from-app-gateway">#</a></h4>
<p>Go to:</p>
<p>App Gateway ‚Üí <strong>Backend health</strong></p>
<p>Here you‚Äôll see:</p>
<table>
  <thead>
      <tr>
          <th>Backend</th>
          <th>Status</th>
          <th>Code</th>
          <th>Description</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>10.0.1.4</td>
          <td>Unknown</td>
          <td>0</td>
          <td>No response</td>
      </tr>
      <tr>
          <td>10.0.1.5</td>
          <td>Unhealthy</td>
          <td>403</td>
          <td>Probe failed auth</td>
      </tr>
  </tbody>
</table>
<blockquote>
<p>Click each backend to view probe logs and exact error</p></blockquote>
<h4 id="step-6-use-network-watcher">Step 6: Use Network Watcher<a hidden class="anchor" aria-hidden="true" href="#step-6-use-network-watcher">#</a></h4>
<p>Enable <strong>Connection Troubleshoot</strong> from:</p>
<p>Network Watcher ‚Üí <strong>Connection troubleshoot</strong></p>
<ul>
<li>Test from App Gateway subnet ‚Üí Backend IP:Port</li>
<li>Verify reachability and response time</li>
</ul>
<h4 id="fix-summary">Fix Summary<a hidden class="anchor" aria-hidden="true" href="#fix-summary">#</a></h4>
<table>
  <thead>
      <tr>
          <th>Issue</th>
          <th>Fix</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Backend health Unknown</td>
          <td>NSG/UDR block, wrong IP, DNS issue</td>
      </tr>
      <tr>
          <td>Backend health Unhealthy</td>
          <td>Wrong probe path, wrong port/cert</td>
      </tr>
      <tr>
          <td>HTTPS failing probe</td>
          <td>Hostname mismatch or cert issue</td>
      </tr>
      <tr>
          <td>DNS FQDN backend unreachable</td>
          <td>Private DNS or no resolution</td>
      </tr>
      <tr>
          <td>VMs in stopped state</td>
          <td>Start them or replace in backend pool</td>
      </tr>
  </tbody>
</table>
<hr>
<h4 id="quick-fix--sample-nsg-rule">Quick Fix ‚Äì Sample NSG Rule<a hidden class="anchor" aria-hidden="true" href="#quick-fix--sample-nsg-rule">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>az network nsg rule create <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --resource-group myRG <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --nsg-name backend-nsg <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --name AllowAppGw <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --priority <span style="color:#ae81ff">100</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --direction Inbound <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --access Allow <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --protocol Tcp <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --source-address-prefixes &lt;AppGwSubnetPrefix&gt; <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --destination-port-ranges <span style="color:#ae81ff">80</span> <span style="color:#ae81ff">443</span>
</span></span></code></pre></div><p>Final Tips:
Use custom probes over default probes
Always test probe path manually in browser or Postman
For HTTPS, check backend certs and hostname validation
Use FQDN only if DNS is guaranteed to resolve</p>
<p>References:
Troubleshoot App Gateway backend health
Custom probes</p>
<p>Need help debugging your Gateway?
Drop a comment or reach out on LinkedIn!</p>
<p>‚Äì Kasi @ KasdevTech üöÄ</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="http://localhost:1313/tags/azure-application-gateway/">Azure Application Gateway</a></li>
      <li><a href="http://localhost:1313/tags/troubleshooting/">Troubleshooting</a></li>
      <li><a href="http://localhost:1313/tags/probes/">Probes</a></li>
      <li><a href="http://localhost:1313/tags/nsg/">NSG</a></li>
      <li><a href="http://localhost:1313/tags/load-balancer/">Load Balancer</a></li>
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="http://localhost:1313/">KasdevTech</a></span> ¬∑ 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
