<!DOCTYPE html>
<html lang="en" dir="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Azure VM Boot Issue – VM stuck in &#39;Starting&#39; or &#39;Failed&#39; | KasdevTech</title>
<meta name="keywords" content="Azure VM, Troubleshooting, Boot diagnostics, Serial Console, NSG, Repair">
<meta name="description" content="Your Azure VM stuck on &#39;Starting&#39; or &#39;Failed&#39;? Learn how to troubleshoot using Boot Diagnostics, Serial Console, and recovery tools.">
<meta name="author" content="Kasi Suresh">
<link rel="canonical" href="http://localhost:1313/azure/azurevm_issues/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.8fe10233a706bc87f2e08b3cf97b8bd4c0a80f10675a143675d59212121037c0.css" integrity="sha256-j&#43;ECM6cGvIfy4Is8&#43;XuL1MCoDxBnWhQ2ddWSEhIQN8A=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="http://localhost:1313/azure/azurevm_issues/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:url" content="http://localhost:1313/azure/azurevm_issues/">
  <meta property="og:site_name" content="KasdevTech">
  <meta property="og:title" content="Azure VM Boot Issue – VM stuck in &#39;Starting&#39; or &#39;Failed&#39;">
  <meta property="og:description" content="Your Azure VM stuck on &#39;Starting&#39; or &#39;Failed&#39;? Learn how to troubleshoot using Boot Diagnostics, Serial Console, and recovery tools.">
  <meta property="og:locale" content="en-us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="azure">
    <meta property="article:published_time" content="2025-08-03T00:00:00+00:00">
    <meta property="article:modified_time" content="2025-08-03T00:00:00+00:00">
    <meta property="article:tag" content="Azure VM">
    <meta property="article:tag" content="Troubleshooting">
    <meta property="article:tag" content="Boot Diagnostics">
    <meta property="article:tag" content="Serial Console">
    <meta property="article:tag" content="NSG">
    <meta property="article:tag" content="Repair">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Azure VM Boot Issue – VM stuck in &#39;Starting&#39; or &#39;Failed&#39;">
<meta name="twitter:description" content="Your Azure VM stuck on &#39;Starting&#39; or &#39;Failed&#39;? Learn how to troubleshoot using Boot Diagnostics, Serial Console, and recovery tools.">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Azure",
      "item": "http://localhost:1313/azure/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Azure VM Boot Issue – VM stuck in 'Starting' or 'Failed'",
      "item": "http://localhost:1313/azure/azurevm_issues/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Azure VM Boot Issue – VM stuck in 'Starting' or 'Failed'",
  "name": "Azure VM Boot Issue – VM stuck in \u0027Starting\u0027 or \u0027Failed\u0027",
  "description": "Your Azure VM stuck on 'Starting' or 'Failed'? Learn how to troubleshoot using Boot Diagnostics, Serial Console, and recovery tools.",
  "keywords": [
    "Azure VM", "Troubleshooting", "Boot diagnostics", "Serial Console", "NSG", "Repair"
  ],
  "articleBody": "Azure VM Boot Issue – VM stuck in ‘Starting’ or ‘Failed’ You hit Start on your Azure VM… and it gets stuck in:\n“Starting…”\n“Provisioning failed”\n“Failed to start VM”\nYou’re not alone — this is a common issue. In this blog, I’ll show you how to troubleshoot and fix it using step-by-step, beginner-friendly methods.\nCommon Causes Problem Example Corrupt OS disk Kernel panic / bluescreen VM extension failed “Failed to install extension” NSG or route blocking Boot agent No serial output DNS or DHCP misconfigured Stuck boot or network unreachable OS-level login or update hang Incomplete patch Step-by-step Fix Guide Step 1: Open Boot Diagnostics Go to your VM → Boot diagnostics\nCheck Screenshot tab Windows: Blue screen? Login screen? Linux: Kernel panic? Black screen? Check Serial log Look for errors: Failed to mount, No bootable disk, etc. This is your first clue into what went wrong.\nStep 2: Try Serial Console (If OS boots partially) VM → Serial Console\nWindows: Login with credentials Check sconfig or Event logs Linux: Use root shell Check /var/log/syslog or dmesg journalctl -xe systemctl status You can fix fstab, services, or disable broken extensions directly.\nStep 3: Run “Redeploy VM” Go to VM → Support + Troubleshooting → Redeploy This:\nMoves your VM to another host Retains public/private IP and disk Fixes hypervisor-side issues Works well for random “Failed to start” errors. Step 4: Reset SSH or RDP Access (if login fails) VM → Reset password → Choose OS → Reset login\nVM → Run Command → Reset SSH config (Linux)\naz vm user update --name vm1 --resource-group myRG \\ --username azureuser --password 'StrongP@ssword123!' Step 5: Disk Repair (Advanced) Stop VM Detach OS disk Attach to a healthy rescue VM Mount and inspect disk: sudo fdisk -l sudo mount /dev/sdc1 /mnt Fix /etc/fstab, remove bad init files, update kernel Reattach disk to original VM and boot\nStep 6: Check NSG or Route Table Ensure outbound access to: Azure platform IPs (168.63.129.16) DNS (8.8.8.8 or 168.63.129.16) If UDRs block outbound or Boot diagnostics, VM won’t load properly\nSummary Table Fix Use When Boot diagnostics screenshot See if OS booted Serial Console Fix login or boot issues Redeploy VM Platform/infrastructure issues Reset SSH/RDP Login or key problems Disk Repair via Rescue VM Corrupt boot or config file NSG/UDR fix Connectivity / agent failures Pro Tips Always enable Boot Diagnostics for all VMs Take snapshot before running updates Use custom script extension to auto repair Use Availability Set or Zone to avoid platform issues Resources Azure VM Serial Console Redeploy VM guide Run command from portal Facing the boot error right now? Message me on LinkedIn for a walkthrough.\n– Kasi @ KasdevTech\n",
  "wordCount" : "447",
  "inLanguage": "en",
  "datePublished": "2025-08-03T00:00:00Z",
  "dateModified": "2025-08-03T00:00:00Z",
  "author":{
    "@type": "Person",
    "name": "Kasi Suresh"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http://localhost:1313/azure/azurevm_issues/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "KasdevTech",
    "logo": {
      "@type": "ImageObject",
      "url": "http://localhost:1313/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="KasdevTech (Alt + H)">
                <img src="http://localhost:1313/images/kasdev.png" alt="" aria-label="logo"
                    height="30">KasdevTech</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/azure/" title="Azure">
                    <span>Azure</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/az-104/" title="AZ-104">
                    <span>AZ-104</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/devops/" title="DevOps">
                    <span>DevOps</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/finops/" title="FinOps">
                    <span>FinOps</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/terraform/" title="Terraform">
                    <span>Terraform</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/ai/" title="AI">
                    <span>AI</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/finsight/" title="Finsight">
                    <span>Finsight</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/about/" title="About">
                    <span>About</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      Azure VM Boot Issue – VM stuck in &#39;Starting&#39; or &#39;Failed&#39;
    </h1>
    <div class="post-description">
      Your Azure VM stuck on &#39;Starting&#39; or &#39;Failed&#39;? Learn how to troubleshoot using Boot Diagnostics, Serial Console, and recovery tools.
    </div>
    <div class="post-meta"><span title='2025-08-03 00:00:00 +0000 UTC'>August 3, 2025</span>&nbsp;·&nbsp;3 min&nbsp;·&nbsp;Kasi Suresh

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#azure-vm-boot-issue--vm-stuck-in-starting-or-failed" aria-label="Azure VM Boot Issue – VM stuck in &lsquo;Starting&rsquo; or &lsquo;Failed&rsquo;">Azure VM Boot Issue – VM stuck in &lsquo;Starting&rsquo; or &lsquo;Failed&rsquo;</a></li>
                <li>
                    <a href="#common-causes" aria-label="Common Causes">Common Causes</a></li>
                <li>
                    <a href="#step-by-step-fix-guide" aria-label="Step-by-step Fix Guide">Step-by-step Fix Guide</a></li>
                <li>
                    <a href="#step-1-open-boot-diagnostics" aria-label="Step 1: Open Boot Diagnostics">Step 1: Open Boot Diagnostics</a></li>
                <li>
                    <a href="#step-2-try-serial-console-if-os-boots-partially" aria-label="Step 2: Try Serial Console (If OS boots partially)">Step 2: Try Serial Console (If OS boots partially)</a></li>
                <li>
                    <a href="#step-3-run-redeploy-vm" aria-label="Step 3: Run “Redeploy VM”">Step 3: Run “Redeploy VM”</a></li>
                <li>
                    <a href="#step-4-reset-ssh-or-rdp-access-if-login-fails" aria-label="Step 4: Reset SSH or RDP Access (if login fails)">Step 4: Reset SSH or RDP Access (if login fails)</a></li>
                <li>
                    <a href="#step-5-disk-repair-advanced" aria-label="Step 5: Disk Repair (Advanced)">Step 5: Disk Repair (Advanced)</a></li>
                <li>
                    <a href="#step-6-check-nsg-or-route-table" aria-label="Step 6: Check NSG or Route Table">Step 6: Check NSG or Route Table</a></li>
                <li>
                    <a href="#summary-table" aria-label="Summary Table">Summary Table</a></li>
                <li>
                    <a href="#pro-tips" aria-label="Pro Tips">Pro Tips</a></li>
                <li>
                    <a href="#resources" aria-label="Resources">Resources</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h4 id="azure-vm-boot-issue--vm-stuck-in-starting-or-failed">Azure VM Boot Issue – VM stuck in &lsquo;Starting&rsquo; or &lsquo;Failed&rsquo;<a hidden class="anchor" aria-hidden="true" href="#azure-vm-boot-issue--vm-stuck-in-starting-or-failed">#</a></h4>
<p>You hit Start on your Azure VM… and it gets stuck in:</p>
<blockquote>
<p>&ldquo;Starting&hellip;&rdquo;<br>
&ldquo;Provisioning failed&rdquo;<br>
&ldquo;Failed to start VM&rdquo;</p></blockquote>
<p>You&rsquo;re not alone — this is a common issue. In this blog, I’ll show you how to troubleshoot and fix it using <strong>step-by-step, beginner-friendly methods.</strong></p>
<h4 id="common-causes">Common Causes<a hidden class="anchor" aria-hidden="true" href="#common-causes">#</a></h4>
<table>
  <thead>
      <tr>
          <th>Problem</th>
          <th>Example</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Corrupt OS disk</td>
          <td>Kernel panic / bluescreen</td>
      </tr>
      <tr>
          <td>VM extension failed</td>
          <td>&ldquo;Failed to install extension&rdquo;</td>
      </tr>
      <tr>
          <td>NSG or route blocking Boot agent</td>
          <td>No serial output</td>
      </tr>
      <tr>
          <td>DNS or DHCP misconfigured</td>
          <td>Stuck boot or network unreachable</td>
      </tr>
      <tr>
          <td>OS-level login or update hang</td>
          <td>Incomplete patch</td>
      </tr>
  </tbody>
</table>
<h4 id="step-by-step-fix-guide">Step-by-step Fix Guide<a hidden class="anchor" aria-hidden="true" href="#step-by-step-fix-guide">#</a></h4>
<h4 id="step-1-open-boot-diagnostics">Step 1: Open Boot Diagnostics<a hidden class="anchor" aria-hidden="true" href="#step-1-open-boot-diagnostics">#</a></h4>
<p>Go to your VM → <strong>Boot diagnostics</strong></p>
<ul>
<li>Check <strong>Screenshot</strong> tab
<ul>
<li>Windows: Blue screen? Login screen?</li>
<li>Linux: Kernel panic? Black screen?</li>
</ul>
</li>
<li>Check <strong>Serial log</strong>
<ul>
<li>Look for errors: <code>Failed to mount</code>, <code>No bootable disk</code>, etc.</li>
</ul>
</li>
</ul>
<blockquote>
<p>This is your first clue into what went wrong.</p></blockquote>
<h4 id="step-2-try-serial-console-if-os-boots-partially">Step 2: Try Serial Console (If OS boots partially)<a hidden class="anchor" aria-hidden="true" href="#step-2-try-serial-console-if-os-boots-partially">#</a></h4>
<p>VM → <strong>Serial Console</strong></p>
<ul>
<li>Windows:
<ul>
<li>Login with credentials</li>
<li>Check <code>sconfig</code> or Event logs</li>
</ul>
</li>
<li>Linux:
<ul>
<li>Use root shell</li>
<li>Check <code>/var/log/syslog</code> or <code>dmesg</code></li>
</ul>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>journalctl -xe
</span></span><span style="display:flex;"><span>systemctl status
</span></span></code></pre></div><p>You can fix fstab, services, or disable broken extensions directly.</p>
<h4 id="step-3-run-redeploy-vm">Step 3: Run “Redeploy VM”<a hidden class="anchor" aria-hidden="true" href="#step-3-run-redeploy-vm">#</a></h4>
<p>Go to VM → Support + Troubleshooting → Redeploy
This:</p>
<ul>
<li>Moves your VM to another host</li>
<li>Retains public/private IP and disk</li>
<li>Fixes hypervisor-side issues</li>
<li>Works well for random &ldquo;Failed to start&rdquo; errors.</li>
</ul>
<h4 id="step-4-reset-ssh-or-rdp-access-if-login-fails">Step 4: Reset SSH or RDP Access (if login fails)<a hidden class="anchor" aria-hidden="true" href="#step-4-reset-ssh-or-rdp-access-if-login-fails">#</a></h4>
<p>VM → Reset password → Choose OS → Reset login</p>
<p>VM → Run Command → Reset SSH config (Linux)</p>
<pre tabindex="0"><code>az vm user update --name vm1 --resource-group myRG \
  --username azureuser --password &#39;StrongP@ssword123!&#39;
</code></pre><h4 id="step-5-disk-repair-advanced">Step 5: Disk Repair (Advanced)<a hidden class="anchor" aria-hidden="true" href="#step-5-disk-repair-advanced">#</a></h4>
<ul>
<li>Stop VM</li>
<li>Detach OS disk</li>
<li>Attach to a healthy rescue VM</li>
<li>Mount and inspect disk:</li>
</ul>
<pre tabindex="0"><code>sudo fdisk -l
sudo mount /dev/sdc1 /mnt
Fix /etc/fstab, remove bad init files, update kernel
</code></pre><p>Reattach disk to original VM and boot</p>
<h4 id="step-6-check-nsg-or-route-table">Step 6: Check NSG or Route Table<a hidden class="anchor" aria-hidden="true" href="#step-6-check-nsg-or-route-table">#</a></h4>
<p>Ensure outbound access to:
Azure platform IPs (168.63.129.16)
DNS (8.8.8.8 or 168.63.129.16)
If UDRs block outbound or Boot diagnostics, VM won&rsquo;t load properly</p>
<h4 id="summary-table">Summary Table<a hidden class="anchor" aria-hidden="true" href="#summary-table">#</a></h4>
<table>
  <thead>
      <tr>
          <th>Fix</th>
          <th>Use When</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Boot diagnostics screenshot</td>
          <td>See if OS booted</td>
      </tr>
      <tr>
          <td>Serial Console</td>
          <td>Fix login or boot issues</td>
      </tr>
      <tr>
          <td>Redeploy VM</td>
          <td>Platform/infrastructure issues</td>
      </tr>
      <tr>
          <td>Reset SSH/RDP</td>
          <td>Login or key problems</td>
      </tr>
      <tr>
          <td>Disk Repair via Rescue VM</td>
          <td>Corrupt boot or config file</td>
      </tr>
      <tr>
          <td>NSG/UDR fix</td>
          <td>Connectivity / agent failures</td>
      </tr>
  </tbody>
</table>
<h4 id="pro-tips">Pro Tips<a hidden class="anchor" aria-hidden="true" href="#pro-tips">#</a></h4>
<ul>
<li>Always enable Boot Diagnostics for all VMs</li>
<li>Take snapshot before running updates</li>
<li>Use custom script extension to auto repair</li>
<li>Use Availability Set or Zone to avoid platform issues</li>
</ul>
<h4 id="resources">Resources<a hidden class="anchor" aria-hidden="true" href="#resources">#</a></h4>
<ul>
<li>Azure VM Serial Console</li>
<li>Redeploy VM guide</li>
<li>Run command from portal</li>
<li>Facing the boot error right now?</li>
</ul>
<p>Message me on LinkedIn for a walkthrough.</p>
<p>– Kasi @ KasdevTech</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="http://localhost:1313/tags/azure-vm/">Azure VM</a></li>
      <li><a href="http://localhost:1313/tags/troubleshooting/">Troubleshooting</a></li>
      <li><a href="http://localhost:1313/tags/boot-diagnostics/">Boot Diagnostics</a></li>
      <li><a href="http://localhost:1313/tags/serial-console/">Serial Console</a></li>
      <li><a href="http://localhost:1313/tags/nsg/">NSG</a></li>
      <li><a href="http://localhost:1313/tags/repair/">Repair</a></li>
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="http://localhost:1313/">KasdevTech</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
