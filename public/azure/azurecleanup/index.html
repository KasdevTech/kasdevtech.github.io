<!DOCTYPE html>
<html lang="en" dir="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Automate Azure Cleanup — Before It Costs | KasdevTech</title>
<meta name="keywords" content="Azure, Automation, FinOps, PowerShell, LogicApps">
<meta name="description" content="Learn how to built a weekly automated Azure cleanup flow using PowerShell, Logic Apps, and Teams approvals to avoid surprise cloud bills.">
<meta name="author" content="Kasi Suresh">
<link rel="canonical" href="http://localhost:1313/azure/azurecleanup/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.8fe10233a706bc87f2e08b3cf97b8bd4c0a80f10675a143675d59212121037c0.css" integrity="sha256-j&#43;ECM6cGvIfy4Is8&#43;XuL1MCoDxBnWhQ2ddWSEhIQN8A=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="http://localhost:1313/azure/azurecleanup/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:url" content="http://localhost:1313/azure/azurecleanup/">
  <meta property="og:site_name" content="KasdevTech">
  <meta property="og:title" content="Automate Azure Cleanup — Before It Costs">
  <meta property="og:description" content="Learn how to built a weekly automated Azure cleanup flow using PowerShell, Logic Apps, and Teams approvals to avoid surprise cloud bills.">
  <meta property="og:locale" content="en-us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="azure">
    <meta property="article:published_time" content="2025-07-28T00:00:00+00:00">
    <meta property="article:modified_time" content="2025-07-28T00:00:00+00:00">
    <meta property="article:tag" content="Azure">
    <meta property="article:tag" content="Automation">
    <meta property="article:tag" content="FinOps">
    <meta property="article:tag" content="PowerShell">
    <meta property="article:tag" content="LogicApps">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Automate Azure Cleanup — Before It Costs">
<meta name="twitter:description" content="Learn how to built a weekly automated Azure cleanup flow using PowerShell, Logic Apps, and Teams approvals to avoid surprise cloud bills.">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Azure",
      "item": "http://localhost:1313/azure/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Automate Azure Cleanup — Before It Costs",
      "item": "http://localhost:1313/azure/azurecleanup/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Automate Azure Cleanup — Before It Costs",
  "name": "Automate Azure Cleanup — Before It Costs",
  "description": "Learn how to built a weekly automated Azure cleanup flow using PowerShell, Logic Apps, and Teams approvals to avoid surprise cloud bills.",
  "keywords": [
    "Azure", "Automation", "FinOps", "PowerShell", "LogicApps"
  ],
  "articleBody": "Automate Azure Cleanup — Before It Costs Me Most of us don’t realize how fast an Azure bill can grow — until we get that painful monthly invoice.\nThe surprise? It’s rarely because of production workloads.\nIt’s the small, forgotten things:\nTest VMs that should’ve been deleted Staging App Services left running Orphaned managed disks Zombie NICs that no one even remembers creating These idle resources quietly drain money.\nSolution: Weekly Automated Cleanup Instead of manually checking everything, I built a simple system that does it all for me — safely and automatically.\nHere’s what my setup includes:\nA PowerShell script that scans for unused resources An Azure Logic App that sends me an approval request in Microsoft Teams After approval, it deletes the resources Every action is logged to Azure Storage and Log Analytics Step-by-Step: How It Works Step 1: Detect Unused Resources with PowerShell # Find Unused Disks $unusedDisks = Get-AzDisk | Where-Object { -not $_.ManagedBy } # Find Zombie NICs $zombieNICs = Get-AzNetworkInterface | Where-Object { -not $_.VirtualMachine -and $_.ProvisioningState -eq 'Succeeded' } # Save the list to JSON $resources = [PSCustomObject]@{ UnusedDisks = $unusedDisks.Id ZombieNICs = $zombieNICs.Id } $resources | ConvertTo-Json -Depth 5 | Out-File \"cleanupResources.json\" This script runs weekly on a schedule and saves the list of cleanup candidates. Step 2: Trigger a Logic App for Approval I set up a Logic App that runs whenever the JSON file is uploaded to Blob Storage, or on a timer (e.g. every Sunday).\nIt reads the list and sends a message to Microsoft Teams using an Adaptive Card.\nThe card gives me the option to Approve or Reject the cleanup.\nStep 3: Delete Resources After Approval If I approve the cleanup, the Logic App triggers an Azure Automation Runbook, which runs this PowerShell:\nparam ( [string[]]$DiskIds, [string[]]$NICIds ) foreach ($disk in $DiskIds) { Remove-AzDisk -ResourceId $disk -Force Write-Output \"Deleted Disk: $disk\" } foreach ($nic in $NICIds) { Remove-AzNetworkInterface -ResourceId $nic -Force Write-Output \"Deleted NIC: $nic\" } I’ve granted the automation account Managed Identity access so it can safely delete resources with the right permissions. Step 4: Log Everything All deletion actions are logged to:\nAzure Log Analytics Workspace for easy querying and alerts\nOptionally to Azure Storage Table or a Blob for historical auditing\nWrite-Output \"Deleted: $resourceId at $(Get-Date)\" Best Practice: Use Tags to Protect Critical Resources\nTo avoid accidental deletes, I check for tags before including resources in the deletion list. Example: Only delete if AutoDelete = True Skip anything tagged with Environment = Production You can add this logic inside the detection PowerShell script. Why This Works This automation is simple but powerful. Avoid unexpected cost Keep my Azure environment clean Maintain an approval flow for transparency Final Take: Cleanup isn’t just a FinOps task — it’s hygiene. The longer you leave unused resources running, the more they cost you in silence. So I automated it. And I recommend you do the same.\nNeed help setting it up? Reach out to me — I’m happy to share the full setup.\n– Kasi @ KasdevTech or LinkedIn\n",
  "wordCount" : "511",
  "inLanguage": "en",
  "datePublished": "2025-07-28T00:00:00Z",
  "dateModified": "2025-07-28T00:00:00Z",
  "author":{
    "@type": "Person",
    "name": "Kasi Suresh"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http://localhost:1313/azure/azurecleanup/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "KasdevTech",
    "logo": {
      "@type": "ImageObject",
      "url": "http://localhost:1313/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="KasdevTech (Alt + H)">
                <img src="http://localhost:1313/images/kasdev.png" alt="" aria-label="logo"
                    height="30">KasdevTech</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/azure/" title="Azure">
                    <span>Azure</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/az-104/" title="AZ-104">
                    <span>AZ-104</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/devops/" title="DevOps">
                    <span>DevOps</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/finops/" title="FinOps">
                    <span>FinOps</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/terraform/" title="Terraform">
                    <span>Terraform</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/ai/" title="AI">
                    <span>AI</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/finsight/" title="Finsight">
                    <span>Finsight</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/about/" title="About">
                    <span>About</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      Automate Azure Cleanup — Before It Costs
    </h1>
    <div class="post-description">
      Learn how to built a weekly automated Azure cleanup flow using PowerShell, Logic Apps, and Teams approvals to avoid surprise cloud bills.
    </div>
    <div class="post-meta"><span title='2025-07-28 00:00:00 +0000 UTC'>July 28, 2025</span>&nbsp;·&nbsp;3 min&nbsp;·&nbsp;Kasi Suresh

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#automate-azure-cleanup--before-it-costs-me" aria-label="Automate Azure Cleanup — Before It Costs Me">Automate Azure Cleanup — Before It Costs Me</a></li>
                <li>
                    <a href="#solution-weekly-automated-cleanup" aria-label="Solution: Weekly Automated Cleanup">Solution: Weekly Automated Cleanup</a></li>
                <li>
                    <a href="#step-by-step-how-it-works" aria-label="Step-by-Step: How It Works">Step-by-Step: How It Works</a></li>
                <li>
                    <a href="#step-1-detect-unused-resources-with-powershell" aria-label="Step 1: Detect Unused Resources with PowerShell">Step 1: Detect Unused Resources with PowerShell</a></li>
                <li>
                    <a href="#step-2-trigger-a-logic-app-for-approval" aria-label="Step 2: Trigger a Logic App for Approval">Step 2: Trigger a Logic App for Approval</a></li>
                <li>
                    <a href="#step-3-delete-resources-after-approval" aria-label="Step 3: Delete Resources After Approval">Step 3: Delete Resources After Approval</a></li>
                <li>
                    <a href="#step-4-log-everything" aria-label="Step 4: Log Everything">Step 4: Log Everything</a></li>
                <li>
                    <a href="#example" aria-label="Example:">Example:</a></li>
                <li>
                    <a href="#why-this-works" aria-label="Why This Works">Why This Works</a></li>
                <li>
                    <a href="#final-take" aria-label="Final Take:">Final Take:</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h3 id="automate-azure-cleanup--before-it-costs-me">Automate Azure Cleanup — Before It Costs Me<a hidden class="anchor" aria-hidden="true" href="#automate-azure-cleanup--before-it-costs-me">#</a></h3>
<p>Most of us don’t realize how fast an Azure bill can grow — until we get that painful monthly invoice.</p>
<p>The surprise? It’s rarely because of production workloads.</p>
<p>It’s the small, forgotten things:</p>
<ul>
<li>Test VMs that should’ve been deleted</li>
<li>Staging App Services left running</li>
<li>Orphaned managed disks</li>
<li>Zombie NICs that no one even remembers creating</li>
</ul>
<p>These idle resources quietly drain money.</p>
<hr>
<h3 id="solution-weekly-automated-cleanup">Solution: Weekly Automated Cleanup<a hidden class="anchor" aria-hidden="true" href="#solution-weekly-automated-cleanup">#</a></h3>
<p>Instead of manually checking everything, I built a simple system that does it all for me — safely and automatically.</p>
<p>Here’s what my setup includes:</p>
<ul>
<li>A <strong>PowerShell script</strong> that scans for unused resources</li>
<li>An <strong>Azure Logic App</strong> that sends me an <strong>approval request in Microsoft Teams</strong></li>
<li>After approval, it deletes the resources</li>
<li>Every action is logged to <strong>Azure Storage</strong> and <strong>Log Analytics</strong></li>
</ul>
<h3 id="step-by-step-how-it-works">Step-by-Step: How It Works<a hidden class="anchor" aria-hidden="true" href="#step-by-step-how-it-works">#</a></h3>
<h3 id="step-1-detect-unused-resources-with-powershell">Step 1: Detect Unused Resources with PowerShell<a hidden class="anchor" aria-hidden="true" href="#step-1-detect-unused-resources-with-powershell">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span><span style="color:#75715e"># Find Unused Disks</span>
</span></span><span style="display:flex;"><span>$unusedDisks = Get-AzDisk | Where-Object { <span style="color:#f92672">-not</span> $_.ManagedBy }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Find Zombie NICs</span>
</span></span><span style="display:flex;"><span>$zombieNICs = Get-AzNetworkInterface | Where-Object {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">-not</span> $_.VirtualMachine <span style="color:#f92672">-and</span> $_.ProvisioningState <span style="color:#f92672">-eq</span> <span style="color:#e6db74">&#39;Succeeded&#39;</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Save the list to JSON</span>
</span></span><span style="display:flex;"><span>$resources = [<span style="color:#66d9ef">PSCustomObject</span>]@{
</span></span><span style="display:flex;"><span>    UnusedDisks = $unusedDisks.Id
</span></span><span style="display:flex;"><span>    ZombieNICs  = $zombieNICs.Id
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>$resources | ConvertTo-Json -Depth <span style="color:#ae81ff">5</span> | Out-File <span style="color:#e6db74">&#34;cleanupResources.json&#34;</span>
</span></span><span style="display:flex;"><span>This script runs weekly on a schedule and saves the list of cleanup candidates.
</span></span></code></pre></div><h3 id="step-2-trigger-a-logic-app-for-approval">Step 2: Trigger a Logic App for Approval<a hidden class="anchor" aria-hidden="true" href="#step-2-trigger-a-logic-app-for-approval">#</a></h3>
<p>I set up a Logic App that runs whenever the JSON file is uploaded to Blob Storage, or on a timer (e.g. every Sunday).</p>
<p>It reads the list and sends a message to Microsoft Teams using an Adaptive Card.</p>
<p>The card gives me the option to Approve or Reject the cleanup.</p>
<h3 id="step-3-delete-resources-after-approval">Step 3: Delete Resources After Approval<a hidden class="anchor" aria-hidden="true" href="#step-3-delete-resources-after-approval">#</a></h3>
<p>If I approve the cleanup, the Logic App triggers an Azure Automation Runbook, which runs this PowerShell:</p>
<pre tabindex="0"><code>
param (
    [string[]]$DiskIds,
    [string[]]$NICIds
)

foreach ($disk in $DiskIds) {
    Remove-AzDisk -ResourceId $disk -Force
    Write-Output &#34;Deleted Disk: $disk&#34;
}

foreach ($nic in $NICIds) {
    Remove-AzNetworkInterface -ResourceId $nic -Force
    Write-Output &#34;Deleted NIC: $nic&#34;
}
I’ve granted the automation account Managed Identity access so it can safely delete resources with the right permissions.
</code></pre><h3 id="step-4-log-everything">Step 4: Log Everything<a hidden class="anchor" aria-hidden="true" href="#step-4-log-everything">#</a></h3>
<p>All deletion actions are logged to:</p>
<p>Azure Log Analytics Workspace for easy querying and alerts</p>
<p>Optionally to Azure Storage Table or a Blob for historical auditing</p>
<pre tabindex="0"><code>Write-Output &#34;Deleted: $resourceId at $(Get-Date)&#34;
</code></pre><p>Best Practice: Use Tags to Protect Critical Resources</p>
<ul>
<li>To avoid accidental deletes, I check for tags before including resources in the deletion list.</li>
</ul>
<h3 id="example">Example:<a hidden class="anchor" aria-hidden="true" href="#example">#</a></h3>
<ul>
<li>Only delete if AutoDelete = True</li>
<li>Skip anything tagged with Environment = Production</li>
<li>You can add this logic inside the detection PowerShell script.</li>
</ul>
<h3 id="why-this-works">Why This Works<a hidden class="anchor" aria-hidden="true" href="#why-this-works">#</a></h3>
<ul>
<li>This automation is simple but powerful.</li>
<li>Avoid unexpected cost</li>
<li>Keep my Azure environment clean</li>
<li>Maintain an approval flow for transparency</li>
</ul>
<h3 id="final-take">Final Take:<a hidden class="anchor" aria-hidden="true" href="#final-take">#</a></h3>
<ul>
<li>Cleanup isn’t just a FinOps task — it’s hygiene.</li>
<li>The longer you leave unused resources running, the more they cost you in silence.</li>
</ul>
<p>So I automated it.
And I recommend you do the same.</p>
<p>Need help setting it up? Reach out to me — I’m happy to share the full setup.</p>
<p><strong>– Kasi @ <a href="https://kasdevtech.com">KasdevTech</a></strong> or <a href="https://www.linkedin.com/in/kasi-suresh-992675177/">LinkedIn</a></p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="http://localhost:1313/tags/azure/">Azure</a></li>
      <li><a href="http://localhost:1313/tags/automation/">Automation</a></li>
      <li><a href="http://localhost:1313/tags/finops/">FinOps</a></li>
      <li><a href="http://localhost:1313/tags/powershell/">PowerShell</a></li>
      <li><a href="http://localhost:1313/tags/logicapps/">LogicApps</a></li>
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="http://localhost:1313/">KasdevTech</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
